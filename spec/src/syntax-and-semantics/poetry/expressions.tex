\subsubsection{Expressions}
\label{sec:expressions}

Seeing as the entirety of \Poetry{} (and admittedly, much of \Trilogy{} as a whole)
is made up of expressions, there are a lot of cases.

Though the expression grammar does include binary operators and other binary keywords
\Trilogy{} does not encode precedence as part of the grammar but instead resolves that
in a later pass in the interpreter (\S\ref{sec:precedence}).

\begin{bnf*}
    \bnfprod{ExpressionNoBlock}{
        \bnfpn{Primitive}
        \bnfor
        \bnfpn{Compound}
        \bnfor
        \bnfpn{Comprehension}
        \bnfor
    } \\
    \bnfmore{
        \bnfpn{Reference}
        \bnfor
        \bnfpn{MemberAccess}
        \bnfor
        \bnfpn{ModuleAccess}
        \bnfor
    } \\
    \bnfmore{
        \bnfpn{Application}
        \bnfor
        \bnfpn{ProcedureCall}
        \bnfor
        \bnfpn{BinOp}
        \bnfor
    } \\
    \bnfmore{
        \bnfpn{UnaryOp}
        \bnfor
        \bnfpn{Let}
        \bnfor
        \bnfpn{IfElse}
        \bnfor
        \bnfpn{MatchElse}
        \bnfor
        \bnfpn{Is}
        \bnfor
    } \\
    \bnfmore{
        \bnfpn{End}
        \bnfor
        \bnfpn{Exit}
        \bnfor
        \bnfpn{Resume}
        \bnfor
        \bnfpn{Cancel}
        \bnfor
        \bnfpn{Become}
        \bnfor
    } \\
    \bnfmore{
        \bnfpn{Return}
        \bnfor
        \bnfpn{Break}
        \bnfor
        \bnfpn{Continue}
        \bnfor
        \bnfpn{Super}
        \bnfor
    } \\
    \bnfmore{
        \bnfpn{FnClosure}
        \bnfor
        \bnfpn{DoClosure}
        \bnfor
        \bnfpn{QyClosure}
        \bnfor
        \bnfpn{Handled}
        \bnfor
    } \\
    \bnfmore{
        \bnfpn{Template}
        \bnfor
        \bnfts{(}
        \bnfsp
        \bnfpn{Expression}
        \bnfsp
        \bnfts{)}
    }
\end{bnf*}

For disambiguation purposes, we do not permit blocks to be used fully interchangeably with
regular expressions (though nearly). In places where it may be ambiguous, blocks are typically
considered to be part of the next clause of a statement, rather than part of an existing
expression. Meanwhile, to explicitly separate an expression into the next clause of a statement
without using a block, the \kw{then} keyword is used to denote the beginning of the following
expression.

\begin{bnf*}
    \bnfprod{Expression}{
        \bnfpn{ExpressionNoBlock}
        \bnfor
        \bnfpn{Block}
    } \\
    \bnfprod{FollowingExpression}{
        \bnfts{\kw{then}}
        \bnfsp
        \bnfpn{Expression}
        \bnfor
        \bnfpn{Block}
    } \\
\end{bnf*}
