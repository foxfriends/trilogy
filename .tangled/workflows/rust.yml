engine: "nixery"

when:
  - event: ["push", "pull_request"]
    branch: "main"

dependencies:
  nixpkgs:
    - "rustup"
    - "clang"
    - "libllvm"
    - "valgrind"

steps:
  - name: "Install Rust"
    command: |
      rustup toolchain install stable
      rustup component add rustfmt
      rustup component add clippy
  - name: "Format"
    command: "cargo fmt -- --check"
  - name: "Clippy"
    command: "LLVM_SYS_191_PREFIX=$(llvm-config --prefix) cargo clippy -- -D warnings"
  - name: "Test"
    command: "LLVM_SYS_191_PREFIX=$(llvm-config --prefix) cargo test"
